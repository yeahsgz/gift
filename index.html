<!DOCTYPE html>
<html>
<head lang="zh-Hans">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1,minimum-scale=1">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="applicable-device" content="mobile">
    <title>摇出你的新年礼物</title>
    <meta name="format-detection" content="telephone=no">
    <meta name="wap-font-scale" content="no">
    <style>
        *{
            margin  :0;
            padding :0;
        }

        .gift-logo-wrap{
            margin :20px auto;
            width  :280px;
            height :280px;
        }

        .gift-logo{
            display :block;
            width   :100%;
            height  :100%;
        }

        .text-align-c{
            text-align :center;
        }

        .font-size36{
            font-size :28px;
        }

        .font-size32{
            font-size :24px;
        }
    </style>
</head>
<body>

<div class="">
    <div class="gift-logo-wrap">
        <img class="gift-logo" src="http://iph.href.lu/400x400" alt=""/>
    </div>
    <div class="font-size36 text-align-c">
        晃动屏幕
    </div>
    <div class="font-size32 text-align-c">领取我的专属礼物</div>
    <div class="j-show-result"></div>
</div>
<script src="http://cdn.static.runoob.com/libs/jquery/1.10.2/jquery.min.js"></script>
<script>
    $(document).ready(function () {
        var debounce = function (fn, delay) {
            var timer = null;

            return function () {

                var context = this;
                var args = arguments;

                clearTimeout(timer);

                timer = setTimeout(function () {
                    fn.apply(context, args)
                }, delay)
            };
        };

        if (window.DeviceMotionEvent) {
            $(window).on('devicemotion', debounce(deviceMotionHandler, 20));
        } else {
            alert('你的设备不支持摇一摇');
        }


        var SHAKE_THRESHOLD = 800;
        var last_update = 0;
        var x, y, z, last_x = 0, last_y = 0, last_z = 0;

        function deviceMotionHandler(eventData) {
            var acceleration = eventData.originalEvent.accelerationIncludingGravity;
            var curTime = new Date().getTime();
            if ((curTime - last_update) > 10) {
                var diffTime = curTime - last_update;
                last_update = curTime;
                x = acceleration.x;
                y = acceleration.y;
                z = acceleration.z;
                var speed = Math.abs(x + y + z - last_x - last_y - last_z) / diffTime * 10000;
                if (speed > SHAKE_THRESHOLD) {
                    $('.j-show-result').append("你中奖啦！");  // Do something
                }
                last_x = x;
                last_y = y;
                last_z = z;
            }
        }
    })

</script>
</body>
</html>